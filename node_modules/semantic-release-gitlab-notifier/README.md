# semantic-release-gitlab-notifier

[![build status](https://gitlab.com/hyper-expanse/semantic-release-gitlab-notifier/badges/master/build.svg)](https://gitlab.com/hyper-expanse/semantic-release-gitlab-notifier/commits/master)
[![codecov.io](https://codecov.io/gitlab/hyper-expanse/semantic-release-gitlab-notifier/coverage.svg?branch=master)](https://codecov.io/gitlab/hyper-expanse/semantic-release-gitlab-notifier?branch=master)

> semantic-release-gitlab plugin to post comments to GitLab issues closed by changes included in a package release.

A comment is posted to each issue that has been closed by a change included in a release of your package.

The message that will be posted says: `Version [THE VERSION RELEASED] has been released.`

## Installation

To install the `semantic-release-gitlab-notifier` plugin for use in your own package publishing tool please run the following command:

```bash
npm install --save semantic-release-gitlab-notifier
```

## Usage

`semantic-release-gitlab-notifier`, when called, returns a promise.

It takes one parameter, a configuration object, that contains options that alter its behavior, and data needed to create issue comments.

### Configuration

The configuration parameter required by `semantic-release-gitlab-notifier` must have the following properties:

### pkg

A copy of the to-be-released project's `package.json` file. This must include a `repository` property with the path to the project's git repository on GitLab. Please see npm's documentation on the [format of the repository field](https://docs.npmjs.com/files/package.json#repository<Paste>). The repository field is parsed by [git-pkg-repo](get-pkg-repo), supporting many formats, including HTTPS and SSH.

### options

`options` is an object with the following properties:

* `debug`
* `scmToken`

#### debug
**Default:** _false_

Set to `true` to enable debug mode. In debug mode all input will be validated, but no comments will be posted to GitLab.

This serves a different purpose than the _[Debugging](#debugging)_ section; which simply prints debug messages to the console.

#### scmToken

An authentication token with access to the to-be-released project so that comments can be posted to the project's issues.

**Authentication Requirements**

The account associated with the authentication token must have _Guest_ permissions on the project so that this plugin may use the _Leave comments_ action, as documented on the [GitLab Permissions](http://docs.gitlab.com/ce/user/permissions.html) site.

### data

`data` is an object with the following property:

* `commits`
* `version`

#### commits

An array containing each commit's commit message in the form of a string.

#### version

A string, that's a valid semantic version, representing the version that's been released.

### Example

```javascript
var gitlabNotifier = require('semantic-release-gitlab-notifier');

var config = {};

gitlabNotifier(config)
	.then(function () { /* Commentssuccessfully created on GitLab */ })
	.catch(function () { /* Do any exception handling here */ });
```

## Debugging

To assist users of the `semantic-release-gitlab-notifier` plugin with debugging the behavior of this module we use the [debug](https://www.npmjs.com/package/debug) utility package to print information about the release process to the console. To enable debug message printing, the environment variable `DEBUG`, which is the variable used by the `debug` package, must be set to a value configured by the package containing the debug messages to be printed.

To print debug messages on a unix system set the environment variable `DEBUG` with the name of this package prior to executing a tool that invokes this plugin:

```bash
DEBUG=semantic-release-gitlab-notifier [RELEASE TOOL]
```

On the Windows command line you may do:

```bash
set DEBUG=semantic-release-gitlab-notifier
[RELEASE TOOL]
```

All `semantic-release-gitlab` plugins use `debug` to print information to the console. You can instruct all plugins, and `semantic-release-gitlab`, to print their debug information by using `semantic-release-gitlab*` as the value of the `DEBUG` environment variable.

```bash
DEBUG=semantic-release-gitlab* [RELEASE TOOL]
```

You may also print debug messages for the underlying HTTP request library, [request](https://www.npmjs.com/package/request), by setting the `NODE_DEBUG` environment variable to `request`, as [shown in their documentation](https://www.npmjs.com/package/request#debugging).

As an example:

```bash
NODE_DEBUG=request [RELEASE TOOL]
```

## Contributing

Please read our [contributing](https://gitlab.com/hyper-expanse/semantic-release-gitlab-notifier/blob/master/CONTRIBUTING.md) guide on how you can help improve this project.
