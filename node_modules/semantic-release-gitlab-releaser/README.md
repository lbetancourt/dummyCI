# semantic-release-gitlab-releaser

[![build status](https://gitlab.com/hyper-expanse/semantic-release-gitlab-releaser/badges/master/build.svg)](https://gitlab.com/hyper-expanse/semantic-release-gitlab-releaser/commits/master)
[![codecov.io](https://codecov.io/gitlab/hyper-expanse/semantic-release-gitlab-releaser/coverage.svg?branch=master)](https://codecov.io/gitlab/hyper-expanse/semantic-release-gitlab-releaser?branch=master)

> semantic-release-gitlab plugin that creates a git tag and a GitLab release entry.

Creates a new [GitLab release](http://docs.gitlab.com/ce/workflow/releases.html) matching the version of the package being released. When a release is created on GitLab, a git tag is created along with it. Therefore, it's possible to fetch tags from the GitLab repository for every release created.

The release created on GitLab includes a changelog of all changes introduced in the release. The changelog is created using [conventional-changelog](https://www.npmjs.com/package/conventional-changelog), and the format of the changelog is based on the _preset_ value passed to the plugin.

## Installation

To install the `semantic-release-gitlab-releaser` plugin for use in your own package publishing tool please run the following command:

```bash
npm install --save semantic-release-gitlab-releaser
```

## Usage

`semantic-release-gitlab-releaser`, when called, returns a promise.

It takes one parameter, a configuration object, that contains options that alter its behavior, and data needed to generate the changelog.

### Configuration

The configuration parameter required by `semantic-release-gitlab-releaser` must have the following properties:

### pkg

A copy of the to-be-released project's `package.json` file. This must include a `repository` property with the path to the project's git repository on GitLab. Please see npm's documentation on the [format of the repository field](https://docs.npmjs.com/files/package.json#repository<Paste>). The repository field is parsed by [git-pkg-repo](get-pkg-repo), supporting many formats, including HTTPS and SSH.

### options

`options` is an object with the following properties:

* `debug`
* `preset`
* `scmToken`
* `insecureApi`

#### debug
**Default:** _false_

Set to `true` to enable debug mode. In debug mode all input will be validated, but a release will not be published to GitLab.

This serves a different purpose than the _[Debugging](#debugging)_ section; which simply prints debug messages to the console.

#### preset
**Default:** _angular_

Set to the preferred commit message and changelog format. Once such preset value could be `angular`, which uses the rules codified in [conventional-changelog-angular](https://www.npmjs.com/package/conventional-changelog-angular). The provided preset will be used for extracting information from each commit message based on the format rules established by the preset. Furthermore, the format of the generated chagelog will be based on a template provided by the same preset.

At this time you cannot parse commit messages using one preset, and generate a changelog using the format of another preset.

#### scmToken

An authentication token with access to the to-be-released project on GitLab so that a GitLab release can be created.

**Authentication Requirements**

The account associated with the authentication token must have _Developer_ permissions on the project so that this plugin may use the _Add tags_ action, as documented on the [GitLab Permissions](http://docs.gitlab.com/ce/user/permissions.html) site.

#### insecureApi
**Default:** _undefined_

By default all API calls to GitLab are made over HTTPS. If, for some reason, that's impossible, those API calls can be made over HTTP instead.

To use HTTP set `insecureApi` to `true`.

> We strongly advise against communicating with GitLab over HTTP, but this option is supported for those cases where configuring SSL for GitLab is not feasible.

### Example

```javascript
var gitlabReleaser = require('semantic-release-gitlab-releaser');

var config = {};

gitlabReleaser(config)
	.then(function () { /* Release successfully created on GitLab */ })
	.catch(function () { /* Do any exception handling here */ });
```

## Debugging

To assist users of the `semantic-release-gitlab-releaser` plugin with debugging the behavior of this module we use the [debug](https://www.npmjs.com/package/debug) utility package to print information about the release process to the console. To enable debug message printing, the environment variable `DEBUG`, which is the variable used by the `debug` package, must be set to a value configured by the package containing the debug messages to be printed.

To print debug messages on a unix system set the environment variable `DEBUG` with the name of this package prior to executing a tool that invokes this plugin:

```bash
DEBUG=semantic-release-gitlab-releaser [RELEASE TOOL]
```

On the Windows command line you may do:

```bash
set DEBUG=semantic-release-gitlab-releaser
[RELEASE TOOL]
```

All `semantic-release-gitlab` plugins use `debug` to print information to the console. You can instruct all plugins, and `semantic-release-gitlab`, to print their debugging information by using `semantic-release-gitlab*` as the value of the `DEBUG` environment variable.

```bash
DEBUG=semantic-release-gitlab* [RELEASE TOOL]
```

You may also print debug messages for the underlying HTTP request library, [request](https://www.npmjs.com/package/request), by setting the `NODE_DEBUG` environment variable to `request`, as [shown in their documentation](https://www.npmjs.com/package/request#debugging).

As an example:

```bash
NODE_DEBUG=request [RELEASE TOOL]
```

## Contributing

Please read our [contributing](https://gitlab.com/hyper-expanse/semantic-release-gitlab-releaser/blob/master/CONTRIBUTING.md) guide on how you can help improve this project.
